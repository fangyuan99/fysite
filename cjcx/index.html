<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SCNU硕士课程成绩查询</title>
    <!-- Import style -->
    <link rel="stylesheet" href="//unpkg.com/element-plus/dist/index.css" />
    <!-- Import Vue 3 -->
    <script src="//unpkg.com/vue@3"></script>
    <!-- Import component library -->
    <script src="//unpkg.com/element-plus"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/axios/1.3.4/axios.js"></script>
    <!-- 使用华南师范大学的图标 -->
    <link
      rel="shortcut icon"
      href="//statics.scnu.edu.cn/statics/images/favicon.ico"
    />
    <style>
      body {
        max-width: 800px;
        margin: 0 auto;
        padding: 16px;
      }
      .el-form-item__content {
        display: block;
      }
    </style>
  </head>

  <body>
    <div id="app">
      <h1>SCNU硕士课程成绩查询</h1>
      <el-tag size="large">
        {{name + (name!=='未登录'?`(${account})`:'')}}
      </el-tag>
      <el-form>
        <el-form-item label="账号" :label-width="80">
          <el-input v-model="account"></el-input>
        </el-form-item>
        <el-form-item label="密码" :label-width="80">
          <el-input v-model="password" type="password"></el-input>
          <li style="color: #606266">华师统一身份验证的账号密码</li>
          <li style="color: #606266">
            不存储用户信息，请使用浏览器或第三方密码管理工具
          </li>
        </el-form-item>
        <el-form-item style="display: absolute">
          <el-button
            type="primary"
            @click="fetchData()"
            style="display: relative; float: right"
            >查询</el-button
          >
        </el-form-item>
      </el-form>
      <el-table :data="tableData" style="width: 100%" v-loading="loading">
        <el-table-column prop="课程" label="课程" sortable></el-table-column>
        <el-table-column prop="学分" label="学分" sortable></el-table-column>
        <el-table-column
          prop="考试成绩"
          label="考试成绩"
          sortable
        ></el-table-column>
        <el-table-column
          prop="课程类别"
          label="课程类别"
          sortable
        ></el-table-column>
        <el-table-column
          prop="课程编号"
          label="课程编号"
          sortable
        ></el-table-column>
        <el-table-column
          prop="是否及格"
          label="是否及格"
          sortable
        ></el-table-column>
        <el-table-column
          prop="考试性质"
          label="考试性质"
          sortable
        ></el-table-column>
        <el-table-column
          prop="考试日期"
          label="考试日期"
          sortable
        ></el-table-column>

        <el-table-column prop="备注" label="备注" sortable></el-table-column>
      </el-table>
      <div style="margin-top: 16px">
        <el-divider></el-divider>
        <el-row>
          <el-col :span="8">平均成绩：<strong>{{ avgScore }}</strong></el-col>
        </el-row>
        <el-divider></el-divider>
        <el-row>
          <el-tag type="info">自动健康打卡</el-tag>
          <el-tag type="info" style="margin-left: 10px">请假</el-tag>
        </el-row>
        <el-row>
          <h6>以上功能暂不开放</h6>
        </el-row>
      </div>
    </div>
    <script>
      const app = Vue.createApp({
        data() {
          return {
            tableData: [],
            avgScore: null,
            account: "",
            password: "",
            name: "未登录",
            loading: false,
          };
        },
        methods: {
          async fetchData() {
            this.loading = true;
            try {
              const response = await axios.post("http://localhost:9528/cjcx", {
                account: this.account,
                password: this.password,
              });
              const data = response.data;
              this.tableData = data.tableData;
              this.name = data.name;
              this.calculateAvgScore();
            } catch (error) {
              // loading.close();
              console.log(error);
            }
            this.loading = false;
          },
          calculateAvgScore() {
            let scores = [];
            let count = 0;
            this.tableData.forEach((item) => {
              const score = parseFloat(item.考试成绩);
              if (!isNaN(score)) {
                scores.push(score);
                count++;
              }
            });
            const total = scores.reduce((acc, cur) => acc + cur, 0);
            this.avgScore = (total / count).toFixed(2);
          },
        },
      });
      app.use(ElementPlus);
      app.mount("#app");
    </script>
  </body>
</html>
